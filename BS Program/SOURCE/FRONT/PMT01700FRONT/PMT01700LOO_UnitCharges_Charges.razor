@using PMT01700COMMON.DTO._2._LOO._3._LOO___Unit___Charges.LOO___Unit___Charges___Charges;
@inherits R_Page
@inject R_ILocalizer<Resources_PMT01700_Class> _localizer


<R_StackLayout>
    <R_Grid @ref="@_gridCharges"
            DataSource="_viewModel.oListCharges"
            R_ConductorSource="@_conductorCharges"
            R_GridType="@R_eGridType.Navigator"
            R_ServiceGetListRecord="@GetListCharges"
            Pageable
            Height="250px"
            PageSize="10"
            AllowDeleteRow
            AllowAddNewRow
            AllowEditRow>
        <R_GridColumns>

            <R_GridTextColumn Width="150px"
                              FieldName="@nameof(PMT01700LOO_UnitCharges_ChargesListDTO.CSEQ_NO)"
                              HeaderText="@_localizer["_SeqNo"]" />

            <R_GridTextColumn Width="150px"
                              FieldName="@nameof(PMT01700LOO_UnitCharges_ChargesListDTO.CCHARGES_TYPE_DESCR)"
                              HeaderText="@_localizer["_ChargeType"]" />

            <R_GridTextColumn Width="150px"
                              FieldName="@nameof(PMT01700LOO_UnitCharges_ChargesListDTO.CHARGE_NAME_AND_ID)"
                              HeaderText="@_localizer["_DepositName"]" />

            <R_GridCheckBoxColumn Width="150px"
                                  FieldName="@nameof(PMT01700LOO_UnitCharges_ChargesListDTO.LITEM)"
                                  HeaderText="@_localizer["_Item"]" />

            <R_GridDatePickerColumn Width="150px"
                                    FieldName="@nameof(PMT01700LOO_UnitCharges_ChargesListDTO.DSTART_DATE)"
                                    HeaderText="@_localizer["_StartDate"]" />

            <R_GridDatePickerColumn Width="200px"
                                    FieldName="@nameof(PMT01700LOO_UnitCharges_ChargesListDTO.DEND_DATE)"
                                    HeaderText="@_localizer["_EndDate"]" />

            <R_GridNumericColumn FieldName="@nameof(PMT01700LOO_UnitCharges_ChargesListDTO.IINTERVAL)"
                                 HeaderText="@_localizer["_Interval"]"
                                 Width="125px" />
            <R_GridTextColumn FieldName="@nameof(PMT01700LOO_UnitCharges_ChargesListDTO.CPERIOD_MODE)"
                              HeaderText="@_localizer["_PeriodMode"]"
                              Width="225px" />
            <R_GridNumericColumn FieldName="@nameof(PMT01700LOO_UnitCharges_ChargesListDTO.NFEE_AMT)"
                                 HeaderText="@_localizer["_FeeAmont"]"
                                 Width="125px" />
            <R_GridNumericColumn FieldName="@nameof(PMT01700LOO_UnitCharges_ChargesListDTO.NINVOICE_AMT)"
                                 HeaderText="@_localizer["_InvoiceAmount"]"
                                 Width="125px" />
            <R_GridNumericColumn FieldName="@nameof(PMT01700LOO_UnitCharges_ChargesListDTO.NTOTAL_AMT)"
                                 HeaderText="@_localizer["_TotalAmount"]"
                                 Width="125px" />

            <R_GridTextColumn FieldName="@nameof(PMT01700LOO_UnitCharges_ChargesListDTO.CUPDATE_BY)"
                              HeaderText="@_localizer["_UpdatedBy"]"
                              Width="125px" />
            <R_GridDateTimePickerColumn FieldName="@nameof(PMT01700LOO_UnitCharges_ChargesListDTO.DUPDATE_DATE)"
                                        HeaderText="@_localizer["_UpdatedDate"]"
                                        Width="225px" />
            <R_GridTextColumn FieldName="@nameof(PMT01700LOO_UnitCharges_ChargesListDTO.CCREATE_BY)"
                              HeaderText="@_localizer["_CreatedBy"]"
                              Width="125px" />

            <R_GridDateTimePickerColumn FieldName="@nameof(PMT01700LOO_UnitCharges_ChargesListDTO.DCREATE_DATE)"
                                        HeaderText="@_localizer["_CreatedDate"]"
                                        Width="225px" />
        </R_GridColumns>

    </R_Grid>
</R_StackLayout>

<R_StackLayout Row Class="mt-2">
    @* Detail *@
    <R_StackLayout Class="col-8">

        @* Seq No *@
        <R_ItemLayout col="12" Class="d-flex">
            <R_ItemLayout col="2">
                <R_Label>
                    @_localizer["_SeqNo"]
                </R_Label>
            </R_ItemLayout>

            <R_ItemLayout col="2">
                <R_ItemLayout col="9">
                    <R_TextBox @bind-Value="@_viewModel.Data.CSEQ_NO"
                               R_ConductorSource="@_conductorCharges"
                               Enabled="false" />
                </R_ItemLayout>
            </R_ItemLayout>

            <R_ItemLayout col="8" Class="d-flex">

                <R_ItemLayout col="3" Class="ps-2">
                    <R_Label>
                        @_localizer["_ChargeType"]
                    </R_Label>
                </R_ItemLayout>

                <R_ItemLayout col="3" Class="ps-1">
                    <R_TextBox @bind-Value="@_viewModel.Data.CCHARGES_TYPE"
                               R_ConductorSource="@_conductorCharges"
                               Enabled="false">
                    </R_TextBox>
                </R_ItemLayout>
                <R_ItemLayout col="6" Class="ps-1">
                    <R_TextBox @bind-Value="@_viewModel.Data.CCHARGES_TYPE_DESCR"
                               R_ConductorSource="@_conductorCharges"
                               Enabled="false">
                    </R_TextBox>
                </R_ItemLayout>
            </R_ItemLayout>
        </R_ItemLayout>

        @* Charge Id *@
        <R_ItemLayout col="12" Class="d-flex">
            <R_ItemLayout col="2">
                <R_Label>
                    @_localizer["_ChargeId"]*
                </R_Label>
            </R_ItemLayout>

            <R_ItemLayout col="2">
                <R_TextBox @bind-Value="@_viewModel.Data.CCHARGES_ID"
                           R_ConductorSource="@_conductorCharges"
                           OnLostFocus="@OnLostFocusCharges"
                           R_EnableAdd
                           R_EnableEdit="false">
                </R_TextBox>
                </R_ItemLayout>

                <R_ItemLayout col="8" Class="d-flex">

                <R_ItemLayout col="1" Class="text-center">
                    <R_Lookup R_ConductorSource="@_conductorCharges"
                              @ref="@_BtnLookupCharges"
                              R_EnableAdd
                              R_EnableEdit="false"
                              R_Before_Open_Lookup="@BeforeOpenLookUpChargesLookup"
                              R_After_Open_Lookup="@AfterOpenLookUpChargesLookup">
                        ...
                    </R_Lookup>
                    </R_ItemLayout>

                    <R_ItemLayout col="11">
                    <R_TextBox @bind-Value="@_viewModel.Data.CCHARGES_NAME"
                               R_ConductorSource="@_conductorCharges"
                               Enabled="false">
                    </R_TextBox>
                    </R_ItemLayout>


                    </R_ItemLayout>
                    </R_ItemLayout>

                    @* Invoice Group *@
                    <R_ItemLayout col="12" Class="d-flex">
                    <R_ItemLayout col="2">
                    <R_Label>
                    @_localizer["_InvoiceGroup"]
                    </R_Label>
                    </R_ItemLayout>

                    <R_ItemLayout col="2">
                    <R_TextBox @bind-Value="@_viewModel.Data.CINVGRP_CODE"
                           R_ConductorSource="@_conductorCharges"
                           Enabled="false" />

                    </R_ItemLayout>

                    <R_ItemLayout col="8" Class="d-flex">

                    <R_ItemLayout col="12" Class="ps-1">
                    <R_TextBox @bind-Value="@_viewModel.Data.CINVGRP_NAME"
                               R_ConductorSource="@_conductorCharges"
                               Enabled="false" />
                    </R_ItemLayout>


                    </R_ItemLayout>
                    </R_ItemLayout>

                    @* Tax ID *@
                    <R_ItemLayout col="12" Class="d-flex">
                    <R_ItemLayout col="2">
                    <R_Label>
                    @_localizer["_TaxId"]
                    </R_Label>
                    </R_ItemLayout>

                    <R_ItemLayout col="2">
                    <R_TextBox @bind-Value="@_viewModel.Data.CTAX_ID"
                           R_ConductorSource="@_conductorCharges"
                           OnLostFocus="@OnLostFocusTaxCode"
                           Enabled="@(_viewModel.LTAXABLE && !_oEventCallBack.LCRUD_MODE)"
                           R_EnableAdd
                           R_EnableEdit="false">
                </R_TextBox>
                </R_ItemLayout>

                <R_ItemLayout col="8" Class="d-flex">

                <R_ItemLayout col="1" Class="text-center">
                    <R_Lookup R_ConductorSource="@_conductorCharges"
                              @ref="@R_LookupTaxCodeLookup"                              
                              Enabled="@(_viewModel.LTAXABLE && !_oEventCallBack.LCRUD_MODE)"
                              R_EnableAdd
                              R_EnableEdit="false"
                              R_Before_Open_Lookup="@BeforeOpenLookUpTaxCodeLookup"
                              R_After_Open_Lookup="@AfterOpenLookUpTaxCodeLookup">
                        ...
                    </R_Lookup>
                    </R_ItemLayout>

                    <R_ItemLayout col="11">
                    <R_TextBox @bind-Value="@_viewModel.Data.CTAX_NAME"
                               R_ConductorSource="@_conductorCharges"
                               Enabled="false">
                    </R_TextBox>
                    </R_ItemLayout>


                    </R_ItemLayout>
                    </R_ItemLayout>

                    @* Tenure *@
                    <R_ItemLayout col="12" Class="d-flex">

                    <R_ItemLayout col="2">
                    <R_Label>
                    @_localizer["_Tenure"]
                    </R_Label>
                    </R_ItemLayout>


                    <R_ItemLayout col="10" Class="d-flex justify-content-start">
                    <R_ItemLayout col="7" Class="d-flex justify-content-start">
                    <R_ItemLayout col="2">
                        <R_NumericTextBox Value="@_viewModel.Data.IYEAR"
                                          R_ConductorSource="@_conductorCharges"
                                          ValueChanged="@((Int32 value) => OnChangedCYEAR(value))"
                                          Min="0"
                                          Arrows="false"
                                                R_EnableAdd
                                                R_EnableEdit />
                    </R_ItemLayout>

                    <R_ItemLayout>
                        <R_Label>
                            @_localizer["_Year"]
                        </R_Label>
                    </R_ItemLayout>

                    <R_ItemLayout Class="ps-1" col="2">
                        <R_NumericTextBox Value="@_viewModel.Data.IMONTHS"
                                          R_ConductorSource="@_conductorCharges"
                                          ValueChanged="@((Int32 value) => OnChangedCMONTH(value))"
                                          Min="0"
                                          Arrows="false"
                                                R_EnableAdd
                                                R_EnableEdit>
                        </R_NumericTextBox>
                    </R_ItemLayout>

                    <R_ItemLayout>
                        <R_Label>
                            @_localizer["_Month"]
                        </R_Label>
                    </R_ItemLayout>

                    <R_ItemLayout Class="ps-1" col="2">
                        <R_NumericTextBox Value="@_viewModel.Data.IDAYS"
                                          R_ConductorSource="@_conductorCharges"
                                          ValueChanged="@((Int32 value) => OnChangedCDAY(value))"
                                          Min="0"
                                          Arrows="false"
                                                R_EnableAdd
                                                R_EnableEdit>
                        </R_NumericTextBox>
                    </R_ItemLayout>

                    <R_ItemLayout>
                        <R_Label>
                            @_localizer["_Day"]
                        </R_Label>
                    </R_ItemLayout>
                </R_ItemLayout>
            </R_ItemLayout>

        </R_ItemLayout>



        @* Start Date *@
        <R_ItemLayout col="12" Class="d-flex">

            <R_ItemLayout col="2">
                <R_Label>
                    @_localizer["_StartDate"]*
                </R_Label>
            </R_ItemLayout>

            <R_ItemLayout col="3">
                <R_DatePicker Value="@_viewModel.Data.DSTART_DATE"
                              R_ConductorSource="@_conductorCharges"
                              ValueChanged="@((DateTime? value) => OnChangedDSTART_DATE(value))"
                                R_EnableAdd
                                R_EnableEdit />
            </R_ItemLayout>

            <R_ItemLayout col="1" />

            <R_ItemLayout col="2">
                <R_Label>
                    @_localizer["_EndDate"]*
                </R_Label>
            </R_ItemLayout>

            <R_ItemLayout col="3" Class="ps-1">
                <R_DatePicker Value="@_viewModel.Data.DEND_DATE"
                              R_ConductorSource="@_conductorCharges"
                              ValueChanged="@((DateTime? value) => OnChangedDEND_DATE(value))"
                                R_EnableAdd
                                R_EnableEdit>
                </R_DatePicker>
            </R_ItemLayout>

        </R_ItemLayout>

        @* Billing Method *@
        <R_ItemLayout col="12" Class="d-flex">

            <R_ItemLayout col="2">
                <R_Label>
                    @_localizer["_BillingMode"]*
                </R_Label>
            </R_ItemLayout>

            <R_ItemLayout col="4">
                <R_RadioGroup R_ConductorSource="@_conductorCharges"
                              Data="@_viewModel.loRadioGroupDataCBILLING_MODE"
                              @bind-Value="@_viewModel.Data.CBILLING_MODE"
                                R_EnableAdd
                                R_EnableEdit
                              ValueField="@nameof(PMT01700ComboBoxDTO.CCODE)"
                              TextField="@nameof(PMT01700ComboBoxDTO.CDESCRIPTION)" />
                </R_ItemLayout>

                <R_ItemLayout col="6" Class="d-flex">

                @* Currency  *@
                <R_ItemLayout col="4">
                    <R_Label>
                        @_localizer["_Currency"]*
                    </R_Label>
                </R_ItemLayout>

                <R_ItemLayout col="7" Class="ps-1">
                    <R_TextBox @bind-Value="@_viewModel.Data.CCURRENCY_CODE"
                               R_ConductorSource="@_conductorCharges"
                               OnLostFocus="@OnLostFocusCurrency"
                               R_EnableAdd
                               R_EnableEdit="false">
                    </R_TextBox>
                    </R_ItemLayout>


                    <R_ItemLayout col="1" Class="ps-1 text-center">
                    <R_Lookup R_ConductorSource="@_conductorCharges"
                              @ref="@R_LookupCurrencyLookup"
                              R_EnableAdd
                              R_EnableEdit="false"
                              R_Before_Open_Lookup="@BeforeOpenLookUpCurrencyLookup"
                              R_After_Open_Lookup="@AfterOpenLookUpCurrencyLookup">
                        ...
                    </R_Lookup>
                    </R_ItemLayout>

                    </R_ItemLayout>

                    </R_ItemLayout>


                    @* Fee Method *@
                    <R_ItemLayout col="12" Class="d-flex">
                    <R_ItemLayout col="2">
                    <R_Label>
                    @_localizer["_FeeMethod"]*
                    </R_Label>
                    </R_ItemLayout>

                    <R_ItemLayout col="2">
                    <R_DropDownList Data="@_viewModel.oComboBoxFeeMethod"
                                @bind-Value="_viewModel.Data.CFEE_METHOD"
                                ValueField="@nameof(PMT01700ComboBoxDTO.CCODE)"
                                TextField="@nameof(PMT01700ComboBoxDTO.CDESCRIPTION)"
                                PopupMaxHeight="100px"
                                R_ConductorSource="@_conductorCharges"
                                
                                    R_EnableAdd
                                    R_EnableEdit 
                                    />
            </R_ItemLayout>

            <R_ItemLayout col="8" Class="d-flex">

                <R_ItemLayout col="3" Class="ps-2">
                </R_ItemLayout>

                <R_ItemLayout col="3">
                    <R_Label>
                        @_localizer["_FeeAmount"]
                    </R_Label>
                </R_ItemLayout>

                <R_ItemLayout col="2" Class="ps-1">
                    <R_TextBox @bind-Value="@_viewModel._cCurrencyCode"
                               R_ConductorSource="@_conductorCharges"
                               Enabled="false" />
                </R_ItemLayout>
                <R_ItemLayout col="4" Class="ps-1">
                    <R_NumericTextBox @bind-Value="@_viewModel.Data.NFEE_AMT"
                                      R_ConductorSource="@_conductorCharges"
                                      Min="0"
                                      Enabled="(_lControlCRUD && !_viewModel.Data.LCAL_UNIT)" />
                </R_ItemLayout>

            </R_ItemLayout>
        </R_ItemLayout>

        @* Period Mode*@
        <R_ItemLayout col="12" Class="d-flex">

                <R_ItemLayout col="2">
                    <R_Label>
                        @_localizer["_PeriodMode"]
                    </R_Label>
                </R_ItemLayout>

                <R_ItemLayout col="2">
                <R_DropDownList Data="@_viewModel.oComboBoxPeriodMode"
                                    @bind-Value="_viewModel.Data.CINVOICE_PERIOD"
                                    ValueField="@nameof(PMT01700ComboBoxDTO.CCODE)"
                                    TextField="@nameof(PMT01700ComboBoxDTO.CDESCRIPTION)"
                                    PopupMaxHeight="100px"
                                    R_ConductorSource="@_conductorCharges"
                                    R_EnableAdd
                                    R_EnableEdit />
                </R_ItemLayout>

                <R_ItemLayout col="2" Class="ps-1 d-flex">

                    <R_CheckBox @bind-Value="@_viewModel.Data.LPRORATE"
                            R_ConductorSource="@_conductorCharges"
                                R_EnableAdd
                                R_EnableEdit />

                    <R_ItemLayout col="10" Class="ps-1">
                        <R_Label>
                            @_localizer["_Prorate"]
                        </R_Label>
                    </R_ItemLayout>


                </R_ItemLayout>

                <R_ItemLayout col="8" Class="d-flex">

                    <R_ItemLayout col="3">
                        <R_Label>
                            @_localizer["_InvoiceAmount"]
                        </R_Label>
                    </R_ItemLayout>

                    <R_ItemLayout col="2" Class="ps-1">
                        <R_TextBox @bind-Value="@_viewModel._cCurrencyCode"
                                   R_ConductorSource="@_conductorCharges"
                                   Enabled="false" />
                    </R_ItemLayout>
                    <R_ItemLayout col="4" Class="ps-1">
                        <R_NumericTextBox @bind-Value="@_viewModel.Data.NINVOICE_AMT"
                                          R_ConductorSource="@_conductorCharges"
                                          Enabled="false"
                                          Min="0" />
                    </R_ItemLayout>

                </R_ItemLayout>

            </R_ItemLayout>


        @* Description *@
        <R_ItemLayout col="12" Class="d-flex">
            <R_ItemLayout col="2">
                <R_Label>
                    @_localizer["_Description"]
                </R_Label>
            </R_ItemLayout>

            <R_ItemLayout col="10">
                <R_TextArea @bind-Value="@_viewModel.Data.CDESCRIPTION"
                            R_ConductorSource="@_conductorCharges"
                            R_EnableAdd
                            R_EnableEdit />
            </R_ItemLayout>

        </R_ItemLayout>




    </R_StackLayout>

    <R_ItemLayout col="4">

        @* CheckBox For Detils Item *@
        <R_ItemLayout Class="ps-1 d-flex">
            <R_ItemLayout>
                <R_CheckBox Value="@_viewModel.Data.LCAL_UNIT"
                            R_ConductorSource="@_conductorCharges"
                            ValueChanged="(bool plParam)=>OnChangedLCAL_UNIT(plParam)"
                            R_EnableAdd
                            R_EnableEdit />
            </R_ItemLayout>

            <R_ItemLayout Class="ps-1">
                <R_Label>
                    @_localizer["_DetailItems"]
                </R_Label>
            </R_ItemLayout>

        </R_ItemLayout>
        @* Grid Area *@

        <R_ItemLayout hidden="@(!_viewModel.Data.LCAL_UNIT)">
            <R_GroupBox Title="@_localizer["_FeeCalculation"]">
                <R_StackLayout>

                    <R_Grid @ref="@_gridItemCharges"
                            DataSource="_viewModel.oListChargesItem"
                            R_ConductorGridSource="@_conductorDetailItem"
                            R_GridType="@R_eGridType.Batch"
                            R_ServiceGetListRecord="@GetListCharges_Item"
                            R_Display="R_DisplayAsync"
                            R_ServiceGetRecord="@ServiceGetRecordCharges_Item"
                            R_CellValueChanged="@R_CellLostFocused"
                            R_AfterSave="@R_ServiceAfterSave"
                             R_Validation="R_ValidationItems"
                            
                            Pageable
                            Height="250px"
                            PageSize="10"
                            R_ConductorSource="_conductorCharges"
                            AllowDeleteRow
                            AllowAddNewRow
                            AllowEditRow
                            R_EnableAdd
                            R_EnableEdit>
                        <R_GridColumns>

                            <R_GridTextColumn Width="150px"
                                              FieldName="@nameof(PMT01700LOO_UnitCharges_Charges_ChargesItemDTO.CITEM_NAME)"
                                              HeaderText="@_localizer["_ItemName"]"
                                                        R_EnableAdd
                                                        R_EnableEdit />

                            <R_GridNumericColumn Width="90px"
                                                 FieldName="@nameof(PMT01700LOO_UnitCharges_Charges_ChargesItemDTO.IQTY)"
                                                 HeaderText="@_localizer["_Qty"]"
                                                              R_EnableAdd
                                                              R_EnableEdit
                                                 Min="0" />

                            <R_GridNumericColumn Width="150px"
                                                 FieldName="@nameof(PMT01700LOO_UnitCharges_Charges_ChargesItemDTO.NUNIT_PRICE)"
                                                 HeaderText="@_localizer["_UnitPrice"]"
                                                              R_EnableAdd
                                                              R_EnableEdit
                                                 Min="0" />

                            <R_GridNumericColumn Width="150px"
                                                 FieldName="@nameof(PMT01700LOO_UnitCharges_Charges_ChargesItemDTO.NDISCOUNT)"
                                                 HeaderText="@_localizer["_Discount"]"
                                                              R_EnableAdd
                                                              R_EnableEdit
                                                 Min="0" />

                            <R_GridNumericColumn Width="150px"
                                                 FieldName="@nameof(PMT01700LOO_UnitCharges_Charges_ChargesItemDTO.NTOTAL_PRICE)"
                                                 HeaderText="@_localizer["_TotalPrice"]" />

                        </R_GridColumns>

                        </R_Grid>
                        </R_StackLayout>


                        </R_GroupBox>
                        </R_ItemLayout>
                        </R_ItemLayout>
                        </R_StackLayout>

                        <R_StackLayout Row Class="d-flex justify-content-between">

    <R_StackLayout Row>

        <R_ItemLayout>
            <R_AddButton Enabled="@(!_lControlCRUD)" R_Conductor="@_conductorCharges" /> 
        </R_ItemLayout>

        <R_ItemLayout>
            <R_EditButton Enabled="@(!_lControlCRUD && _hasDataUnit)" R_Conductor="@_conductorCharges" />
        </R_ItemLayout>

        <R_ItemLayout>
            <R_DeleteButton Enabled="@(!_lControlCRUD && _hasDataUnit)" R_Conductor="@_conductorCharges" />
        </R_ItemLayout>

    </R_StackLayout>

    <R_StackLayout Row Class="d-flex justify-content-end">

        <R_StackLayout Row>

            <R_ItemLayout>
                <R_CancelButton R_Conductor="@_conductorCharges" />
            </R_ItemLayout>

            <R_ItemLayout>
                <R_SaveButton R_Conductor="@_conductorCharges" />
            </R_ItemLayout>

        </R_StackLayout>

    </R_StackLayout>

</R_StackLayout>


<R_Conductor @ref="@_conductorCharges"
             R_ViewModel="_viewModel"
             R_IsHeader="true"
             R_ServiceGetRecord="@ServiceGetRecordCharges"
             R_BeforeCancel="@BeforeCancel"
             R_Display="@ServiceR_Display"
             R_ServiceSave="@ServiceSaveCharges"
             R_ServiceDelete="@ServiceDelete"
             R_AfterDelete="@AfterDelete"
             R_Validation="@Validation"
             R_AfterAdd="@ServiceAfterAdd"

             R_SetOther="@SetOther" />

<R_ConductorGrid @ref="@_conductorDetailItem"
                 R_ConductorParent="@_conductorCharges"
                 R_SetOther="@SetOtherChargesItems" />
